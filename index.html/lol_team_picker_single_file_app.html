<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LOL Team Picker</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0b0e12;
      --panel: #11161d;
      --panel-2: #0e1319;
      --gold: #c8aa6e;
      --gold-soft: #a78e5a;
      --text: #e5e7eb;
      --muted: #93a4b4;
      --accent: #0ea5a5;
      --red: #e11d48;
      --blue: #3b82f6;
      --ring: rgba(200,170,110,0.35);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 20% -10%, #132331, transparent 60%),
        radial-gradient(900px 480px at 110% 0%, #1a1021, transparent 50%),
        radial-gradient(800px 600px at 50% 120%, #0f1c26, transparent 60%),
        var(--bg);
      overflow-y: auto;
    }

    .wrap { max-width: 1100px; margin: 0 auto; padding: 24px clamp(16px, 3vw, 32px) 48px; }

    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; margin-bottom: 18px; }
    .title {
      font-family: Cinzel, serif;
      letter-spacing: 0.5px;
      line-height: 1.1;
      font-size: clamp(28px, 4vw, 44px);
      margin: 0;
      color: #fff; /* vit rubrik */
      text-shadow: 0 8px 24px rgba(0,0,0,0.55);
    }
    .subtitle { margin: 4px 0 0 0; color: var(--muted); font-size: 14px; }

    .card { background: linear-gradient(180deg, var(--panel), var(--panel-2)); border: 1px solid rgba(200,170,110,0.18); border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.03); }

    .inputs { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px 18px; padding: 18px; }
    @media (max-width: 720px) { .inputs { grid-template-columns: 1fr; } }

    label { font-size: 12px; color: var(--muted); display: block; margin: 0 0 6px 2px; }

    .field { display: flex; flex-direction: column; padding: 10px 12px; background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.06); border-radius: 12px; transition: border-color .2s ease, box-shadow .2s ease, transform .05s ease; }
    .field:focus-within { border-color: var(--gold); box-shadow: 0 0 0 4px var(--ring); }
    .field input { width: 100%; padding: 10px 8px; font-size: 15px; color: var(--text); background: transparent; border: 0; outline: 0; }

    .actions { display: flex; flex-wrap: wrap; gap: 10px; padding: 12px 18px 18px; align-items: center; }

    .btn { position: relative; display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 10px 14px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.08); background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02)); color: var(--text); cursor: pointer; user-select: none; transition: transform .05s ease, filter .2s ease, border-color .2s ease, box-shadow .2s ease; }
    .btn:hover { filter: brightness(1.05); border-color: rgba(255,255,255,0.18); }
    .btn:active { transform: translateY(1px); }
    .btn.primary { border-color: rgba(200,170,110,0.45); background: linear-gradient(180deg, #2a313a, #12171d); box-shadow: inset 0 1px 0 rgba(255,255,255,0.06), 0 6px 18px rgba(200,170,110,0.15); }
    .btn.blue { border-color: rgba(59,130,246,0.35); }
    .btn.red  { border-color: rgba(225,29,72,0.35); }

    .hint { color: var(--muted); font-size: 12px; margin-left: auto; }
    .error { color: #fecaca; font-size: 13px; padding: 0 18px 12px; }

    .teams { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-top: 20px; }
    @media (max-width: 900px) { .teams { grid-template-columns: 1fr; } }

    .team-card { padding: 16px; position: relative; overflow: hidden; }
    .team-title { display: flex; align-items: center; justify-content: space-between; font-family: Cinzel, serif; letter-spacing: .4px; font-size: 20px; margin: 4px 0 14px; }
    .team-title .tag { font-size: 12px; color: var(--muted); }

    .team.blue { border-color: rgba(59,130,246,0.45); box-shadow: inset 0 0 0 1px rgba(59,130,246,0.35); }
    .team.red  { border-color: rgba(225,29,72,0.45);  box-shadow: inset 0 0 0 1px rgba(225,29,72,0.35); }

    ul.roster { list-style: none; padding: 0; margin: 0; display: grid; gap: 10px; }
    .slot { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 12px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); }
    .name { font-weight: 600; }
    .role { margin-left: auto; font-size: 12px; padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.04); text-transform: uppercase; letter-spacing: .8px; font-weight: 700; }
    .role.top { box-shadow: inset 0 0 0 1px rgba(248, 250, 252, 0.06); }
    .role.jungle { box-shadow: inset 0 0 0 1px rgba(14,165,233,0.25); }
    .role.mid { box-shadow: inset 0 0 0 1px rgba(168,85,247,0.25); }
    .role.adc { box-shadow: inset 0 0 0 1px rgba(34,197,94,0.25); }
    .role.support { box-shadow: inset 0 0 0 1px rgba(234,179,8,0.25); }

    .footer-note { color: var(--muted); font-size: 12px; margin-top: 14px; text-align: right; }

    .divider { height: 1px; background: linear-gradient(90deg, transparent, rgba(200,170,110,0.25), transparent); margin: 12px -16px; }

    .badges { display: flex; gap: 8px; align-items: center; }
    .badge { font-size: 11px; padding: 6px 8px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.12); color: var(--muted); }

    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }

    .toggle { display:flex; align-items:center; gap:8px; }
    .inline-field { display:flex; align-items:center; gap:8px; padding: 8px 10px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); border-radius: 10px; }
    .inline-field input, .inline-field select { background: transparent; border: 0; outline: 0; color: var(--text); }
    .champ { font-size: 12px; padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.12); background: rgba(59,130,246,0.12); }

    .champ-wrap { display:flex; align-items:center; gap:8px; }
    .champ-icon { width: 22px; height: 22px; border-radius: 4px; object-fit: cover; border:1px solid rgba(255,255,255,0.15); background:#0d1117; }

    details#tests { margin-top: 14px; }
    #testOutput { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 12px; white-space: pre-wrap; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); border-radius: 10px; padding: 10px; }

    .ban-row { display:flex; flex-wrap:wrap; gap:8px; margin: 8px 0 0; }
    .ban-label { color: var(--muted); font-size: 12px; margin-right: 8px; }
    .ban {
      padding:6px 8px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.08);
      background:rgba(255,255,255,0.03);
      min-width: 160px;
      color: var(--text); /* vit text i st√§ngd select */
    }
    .ban option { /* l√§sbar i den √∂ppna listan */
      color: #000;
      background-color: #fff;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1 class="title">LOL Team Picker</h1>
        <p class="subtitle">Mata in 10 summoner-namn, v√§lj bans, tryck p√• <em>Randomisera lag</em> och f√• tv√• lag med roller & champions.</p>
      </div>
      <div class="badges" aria-hidden="true">
        <span class="badge">Dark UI</span>
        <span class="badge">LoL‚Äëinspirerad</span>
        <span class="badge">RNG</span>
      </div>
    </header>

    <section class="card" aria-label="Inmatning av spelare">
      <div class="inputs" id="inputs"></div>
      <div class="actions">
        <label class="toggle"><input type="checkbox" id="assignChamp" checked /> Tilldela slumpad champion</label>
        <div class="inline-field" title="Begr√§nsa till dessa champions (komma-separerat, matchar namn eller id). L√§mna tomt f√∂r full pool.">
          <span style="color:var(--muted); font-size:12px">Filter:</span>
          <input id="champFilter" type="text" placeholder="ex. Miss Fortune, Vi, Aatrox" size="32" />
        </div>
        <button class="btn primary" id="randomizeBtn" title="Dela upp i tv√• lag och tilldela">üé≤ Randomisera lag</button>
        <button class="btn blue" id="copyBtn" title="Kopiera resultat till urklipp">üìã Kopiera resultat</button>
        <button class="btn" id="clearBtn" title="T√∂m alla f√§lt">üßΩ Rensa</button>
        <button class="btn" id="testBtn" title="K√∂r inbyggda tester">üß™ K√∂r sj√§lvtest</button>
        <span class="hint">Tips: Dubbelklicka p√• ett f√§lt f√∂r att klona f√∂reg√•ende namn + siffra.</span>
      </div>
      <p class="error" id="error" role="alert" style="display:none"></p>
    </section>

    <section class="teams" aria-live="polite">
      <article class="card team-card team blue" id="blueTeam">
        <div class="team-title"><span>Lag Bl√•</span><span class="tag" id="seedBlue"></span></div>
        <div class="divider"></div>
        <div class="ban-row">
          <span class="ban-label">Bans (3):</span>
          <select class="ban" id="banBlue1"></select>
          <select class="ban" id="banBlue2"></select>
          <select class="ban" id="banBlue3"></select>
        </div>
        <ul class="roster" id="blueRoster"></ul>
      </article>
      <article class="card team-card team red" id="redTeam">
        <div class="team-title"><span>Lag R√∂d</span><span class="tag" id="seedRed"></span></div>
        <div class="divider"></div>
        <div class="ban-row">
          <span class="ban-label">Bans (3):</span>
          <select class="ban" id="banRed1"></select>
          <select class="ban" id="banRed2"></select>
          <select class="ban" id="banRed3"></select>
        </div>
        <ul class="roster" id="redRoster"></ul>
      </article>
    </section>

    <p class="footer-note">Bans √§r <strong>globala</strong>. Roller per lag: Top, Jungle, Mid, ADC, Support (unika inom varje lag). <strong>Champions √§r unika globalt</strong> ‚Äì och h√§mtas nu live fr√•n Riot Data Dragon.</p>

    <details id="tests">
      <summary>üß™ Sj√§lvtest & resultat (klicka f√∂r att visa/d√∂lja)</summary>
      <div id="testOutput">Inga tester k√∂rda √§n.</div>
    </details>
  </div>

  <script>
    // ====== Konstanter & state ======
    const ROLES = ["Top","Jungle","Mid","ADC","Support"];
    // Startpool (fallback) ‚Äì ers√§tts efter fetch med full lista
    const CHAMPS = {
      Top: ["Garen","Darius","Aatrox","Camille","Fiora","Malphite","Sion","Shen","Ornn","Illaoi","Mordekaiser","Jax"],
      Jungle: ["Vi","Kha'Zix","Lee Sin","Amumu","Jarvan IV","Hecarim","Sejuani","Rengar","Kindred","Evelynn","Master Yi","Nidalee"],
      Mid: ["Zed","Ahri","Lux","Annie","Katarina","Yasuo","Sylas","Veigar","Viktor","Orianna","Akali","Talon"],
      ADC: ["Ashe","Jhin","Kai'Sa","Ezreal","Aphelios","Caitlyn","Miss Fortune","Jinx","Xayah","Draven","Lucian","Vayne"],
      Support: ["Leona","Thresh","Nautilus","Lux","Lulu","Nami","Blitzcrank","Morgana","Rakan","Braum","Soraka","Senna"]
    };

    let DD_VER = '14.10.1'; // uppdateras efter fetch
    let CHAMP_IDS = [];     // t.ex. ['Aatrox','Ahri', ...]
    let NAME_BY_ID = {};    // id -> "Miss Fortune"

    // ====== Hj√§lpfunktioner ======
    function sanitize(str) { return (str||'').replace(/[\n\r\t]/g, ' ').trim(); }

    function rng(n) { return Math.floor(crypto.getRandomValues(new Uint32Array(1))[0] / 4294967296 * n); }

    function shuffle(arr) { const a = arr.slice(); for (let i=a.length-1;i>0;i--){ const j=rng(i+1); [a[i],a[j]]=[a[j],a[i]];} return a; }

    function normalizeToken(s){ return s.toLowerCase().replace(/[^a-z0-9]/g,''); }

    function champLabel(id){ return NAME_BY_ID[id] || id; }

    function champImgUrlById(id) {
      return {
        primary: `https://ddragon.leagueoflegends.com/cdn/${DD_VER}/img/champion/${id}.png`,
        fallback: `https://ddragon.leagueoflegends.com/cdn/14.10.1/img/champion/${id}.png`
      };
    }

    // Parsear filterf√§ltet ‚Äì matchar mot b√•de id och "name"
    function parseFilterIds() {
      const raw = sanitize(document.getElementById('champFilter')?.value);
      if (!raw) return [];
      const tokens = raw.split(',').map(s=>normalizeToken(s)).filter(Boolean);
      const byName = Object.entries(NAME_BY_ID).reduce((acc,[id,name])=>{ acc[normalizeToken(name)] = id; return acc; },{});
      const byId = new Set(CHAMP_IDS.map(id=>normalizeToken(id)));
      const out = [];
      for (const t of tokens){
        if (byId.has(t)) { out.push(CHAMP_IDS.find(id=>normalizeToken(id)===t)); continue; }
        if (byName[t]) { out.push(byName[t]); }
      }
      return Array.from(new Set(out));
    }

    function getBans() {
      const pick = id => document.getElementById(id).value;
      const blues = ["banBlue1","banBlue2","banBlue3"].map(pick).filter(Boolean);
      const reds  = ["banRed1","banRed2","banRed3"].map(pick).filter(Boolean);
      return { blues, reds, union: new Set([...blues, ...reds]) };
    }

    // Kandidatpool per roll (efter fetch anv√§nder vi ALLA champs f√∂r alla roller)
    function buildCandidatePool(role, filterIds, bannedSet) {
      const rolePoolFallback = CHAMPS[role] || [];
      const basePoolIds = CHAMP_IDS.length ? CHAMP_IDS : rolePoolFallback.map(n => guessIdFromName(n));
      let pool = basePoolIds;
      if (filterIds.length>0) {
        const set = new Set(filterIds);
        const inter = basePoolIds.filter(id => set.has(id));
        if (inter.length>0) pool = inter;
      }
      return pool.filter(id => !bannedSet.has(id));
    }

    function assignUniqueChampions(blue, red, filterIds, bannedSet) {
      const players = [...blue, ...red];
      const candidates = players.map(p => buildCandidatePool(p.role, filterIds, bannedSet));
      if (candidates.some(c => c.length === 0)) return false;
      const order = [...players.keys()].sort((a,b)=>candidates[a].length - candidates[b].length);
      const used = new Set();
      function backtrack(k){
        if (k===order.length) return true;
        const idx = order[k];
        const pool = shuffle(candidates[idx].filter(id=>!used.has(id)));
        for (const choice of pool){
          used.add(choice);
          players[idx].champ = choice; // champ = id
          if (backtrack(k+1)) return true;
          used.delete(choice);
          players[idx].champ = null;
        }
        return false;
      }
      return backtrack(0);
    }

    function guessIdFromName(name){
      // Hj√§lper fallback-listan att bli id-lik (Miss Fortune -> MissFortune)
      const id = name.replace(/[^A-Za-z0-9]/g,'');
      return id;
    }

    function renderTeam(listEl, team) {
      listEl.innerHTML = '';
      for (const { name, role, champ } of team) {
        const li = document.createElement('li');
        li.className = 'slot';

        const nameSpan = document.createElement('span');
        nameSpan.className = 'name';
        nameSpan.textContent = name;

        if (champ) {
          const wrap = document.createElement('span');
          wrap.className = 'champ-wrap';
          const img = document.createElement('img');
          img.className = 'champ-icon';
          const { primary, fallback } = champImgUrlById(champ);
          img.src = primary;
          img.alt = champLabel(champ);
          img.onerror = () => { img.onerror = null; img.src = fallback; };

          const champPill = document.createElement('span');
          champPill.className = 'champ';
          champPill.textContent = champLabel(champ);

          wrap.appendChild(img);
          wrap.appendChild(champPill);
          li.appendChild(wrap);
        }

        const rolePill = document.createElement('span');
        rolePill.className = 'role ' + role.toLowerCase();
        rolePill.textContent = role;

        li.prepend(nameSpan);
        li.appendChild(rolePill);
        listEl.appendChild(li);
      }
    }

    function formatExport(blue, red) {
      const fmt = (team) => team.map(p => `- ${p.name} (${p.role}${p.champ ? ' ‚Ä¢ ' + champLabel(p.champ) : ''})`).join('\n');
      return `LOL Team Picker\n\nLag Bl√•\n${fmt(blue)}\n\nLag R√∂d\n${fmt(red)}`;
    }

    function showError(msg) { const el = document.getElementById('error'); el.textContent = msg; el.style.display = 'block'; setTimeout(()=>{ el.style.display='none'; }, 4200); }

    function stamp(el, teamLabel) { const n=new Date(); el.textContent = `${teamLabel} ‚Ä¢ ${String(n.getHours()).padStart(2,'0')}:${String(n.getMinutes()).padStart(2,'0')}`; }

    function getNames() {
      const names = [];
      for (let i=0;i<10;i++){
        const v = sanitize(document.getElementById(`p${i}`).value);
        if (!v) return null;
        names.push(v);
      }
      return names;
    }

    function assignTeams(names) {
      const shuffled = shuffle(names);
      const teamBlue = shuffled.slice(0,5);
      const teamRed  = shuffled.slice(5);
      const blueRoles = shuffle(ROLES);
      const redRoles  = shuffle(ROLES);

      const assignChamp = document.getElementById('assignChamp')?.checked;
      const filterIds = parseFilterIds();
      const { union } = getBans();

      const blue = teamBlue.map((name, idx) => ({ name, role: blueRoles[idx], champ: null }));
      const red  = teamRed .map((name, idx) => ({ name, role:  redRoles[idx], champ: null }));

      if (assignChamp) {
        const ok = assignUniqueChampions(blue, red, filterIds, union);
        if (!ok) return { failed: true };
      }
      return { blue, red, failed: false };
    }

    // ====== DOM setup ======
    const inputsEl = document.getElementById('inputs');
    const randomizeBtn = document.getElementById('randomizeBtn');
    const clearBtn = document.getElementById('clearBtn');
    const copyBtn = document.getElementById('copyBtn');
    const testBtn = document.getElementById('testBtn');
    const testOutput = document.getElementById('testOutput');

    for (let i = 0; i < 10; i++) {
      const wrap = document.createElement('div');
      wrap.className = 'field';
      const label = document.createElement('label');
      label.textContent = `Spelare ${i+1}`;
      label.setAttribute('for', `p${i}`);
      const input = document.createElement('input');
      input.id = `p${i}`;
      input.name = `p${i}`;
      input.placeholder = `Summoner ${i+1}`;
      input.autocomplete = 'off';
      input.maxLength = 28;
      const saved = localStorage.getItem(`lolpicker_p${i}`);
      if (saved) input.value = saved;
      input.addEventListener('input', () => { localStorage.setItem(`lolpicker_p${i}`, input.value); });
      input.addEventListener('dblclick', () => {
        if (i > 0) {
          const prev = document.getElementById(`p${i-1}`).value.trim();
          if (prev) input.value = prev.replace(/(\d+)?$/, '') + (i+1);
          input.dispatchEvent(new Event('input'));
        }
      });
      wrap.appendChild(label); wrap.appendChild(input);
      inputsEl.appendChild(wrap);
    }

    function fillBanSelect(sel) {
      const opts = ['<option value="">‚Äî</option>'];
      for (const id of CHAMP_IDS){ opts.push(`<option value="${id}">${champLabel(id)}</option>`); }
      sel.innerHTML = opts.join('');
    }

    async function initChampions() {
      try {
        // H√§mta senaste versionen
        const verRes = await fetch('https://ddragon.leagueoflegends.com/api/versions.json');
        const vers = await verRes.json();
        if (Array.isArray(vers) && vers.length) { DD_VER = vers[0]; }
        // H√§mta champion-listan f√∂r den versionen
        const res = await fetch(`https://ddragon.leagueoflegends.com/cdn/${DD_VER}/data/en_US/champion.json`);
        const data = await res.json();
        const ids = Object.keys(data.data).sort();
        CHAMP_IDS = ids;
        NAME_BY_ID = ids.reduce((acc,id)=>{ acc[id] = data.data[id].name; return acc; },{});
        // S√§tt alla roller till full pool
        for (const r of ROLES) CHAMPS[r] = CHAMP_IDS.slice();
        // Fyll bans-selects
        ['banBlue1','banBlue2','banBlue3','banRed1','banRed2','banRed3'].forEach(id => fillBanSelect(document.getElementById(id)));
      } catch (e) {
        console.warn('Kunde inte h√§mta champions, anv√§nder fallback.', e);
        // Fallback: bygg ID-lista fr√•n h√•rdkodad lista
        const fallbackNames = Array.from(new Set(Object.values(CHAMPS).flat()));
        CHAMP_IDS = fallbackNames.map(guessIdFromName);
        NAME_BY_ID = CHAMP_IDS.reduce((acc,id)=>{ acc[id]=id; return acc; },{});
        ['banBlue1','banBlue2','banBlue3','banRed1','banRed2','banRed3'].forEach(id => fillBanSelect(document.getElementById(id)));
      }
    }

    // ====== Event handlers ======
    randomizeBtn.addEventListener('click', () => {
      const names = getNames();
      if (!names) { showError('Du m√•ste fylla i exakt 10 namn (inga tomma f√§lt).'); return; }

      const { blues, reds } = getBans();
      if (new Set(blues).size !== blues.length || new Set(reds).size !== reds.length) {
        showError('Dubbla bans inom samma lag √§r inte till√•tna.');
        return;
      }

      const result = assignTeams(names);
      if (result.failed) {
        showError('Det gick inte att tilldela unika champions givet bans och/eller filter. L√§tta p√• bans eller t√∂m filtret.');
        return;
      }
      const { blue, red } = result;

      renderTeam(document.getElementById('blueRoster'), blue);
      renderTeam(document.getElementById('redRoster'), red);
      stamp(document.getElementById('seedBlue'), 'Seed');
      stamp(document.getElementById('seedRed'),  'Seed');
      window._lastResult = { blue, red };
    });

    clearBtn.addEventListener('click', () => {
      for (let i=0;i<10;i++){
        const input = document.getElementById(`p${i}`);
        input.value = '';
        localStorage.removeItem(`lolpicker_p${i}`);
      }
      document.getElementById('blueRoster').innerHTML = '';
      document.getElementById('redRoster').innerHTML = '';
      document.getElementById('seedBlue').textContent = '';
      document.getElementById('seedRed').textContent  = '';
      ['banBlue1','banBlue2','banBlue3','banRed1','banRed2','banRed3'].forEach(id => document.getElementById(id).value = '');
      window._lastResult = null;
    });

    copyBtn.addEventListener('click', async () => {
      if (!window._lastResult) { showError('Inget att kopiera √§nnu. Randomisera f√∂rst.'); return; }
      const { blue, red } = window._lastResult;
      try {
        await navigator.clipboard.writeText(formatExport(blue, red));
        copyBtn.textContent = '‚úÖ Kopierat!';
        setTimeout(() => (copyBtn.textContent = 'üìã Kopiera resultat'), 1200);
      } catch (e) {
        showError('Kunde inte kopiera automatiskt. Markera och kopiera manuellt.');
      }
    });

    document.getElementById('p9').addEventListener('keydown', (e) => { if (e.key === 'Enter') randomizeBtn.click(); });

    window.addEventListener('load', async () => {
      // Demo-namn om tomt
      const allEmpty = Array.from({ length: 10 }, (_, i) => document.getElementById(`p${i}`).value.trim()).every(v => !v);
      if (allEmpty) {
        const demo = ['Ashe','Jhin','Kai\'Sa','Kha\'Zix','Vi','Ezreal','Aphelios','Lux','Garen','Zed'];
        demo.forEach((n, i) => { const el = document.getElementById(`p${i}`); el.value = n; });
      }
      await initChampions();
    });

    // ====== Inbyggda tester ======
    function runTests() {
      const log = [];
      const ok = (name, pass, extra='') => log.push(`${pass ? '‚úÖ' : '‚ùå'} ${name}${extra ? ' ‚Äî ' + extra : ''}`);

      try {
        // shuffle
        const arr = [1,2,3,4,5,6,7,8,9,10];
        const sh  = (function(){ let r=arr.slice(); for(let i=0;i<5;i++) r=shuffle(r); return r; })();
        ok('shuffle() length', sh.length === arr.length);
        ok('shuffle() set', [...arr].sort()+'' === [...sh].sort()+'');

        // unique champions assignment w/ fallback pool
        const names = ['A','B','C','D','E','F','G','H','I','J'];
        const rolesBlue = shuffle(ROLES);
        const rolesRed  = shuffle(ROLES);
        const blue = names.slice(0,5).map((n,i)=>({name:n, role:rolesBlue[i], champ:null}));
        const red  = names.slice(5).map((n,i)=>({name:n, role:rolesRed[i], champ:null}));
        const okAssign = assignUniqueChampions(blue, red, [], new Set());
        ok('assignUniqueChampions() lyckas', okAssign);
        if (okAssign) {
          const all = [...blue, ...red].map(p=>p.champ);
          ok('champs unika globalt', new Set(all).size === all.length);
        }

        // bans + filter mapping
        const testIds = ['Ashe','MissFortune'];
        CHAMP_IDS = Array.from(new Set([...CHAMP_IDS, ...testIds]));
        NAME_BY_ID['MissFortune'] = 'Miss Fortune';
        const filterIds = ['MissFortune'];
        const pool = buildCandidatePool('ADC', filterIds, new Set(['MissFortune']));
        ok('bans utesluter filter-tr√§ff', !pool.includes('MissFortune'));

        const u = champImgUrlById('MissFortune');
        ok('champImgUrlById() prim√§r', /\/img\/champion\/MissFortune\.png$/.test(u.primary));
      } catch (e) {
        ok('Undantag i tester', false, e.message || String(e));
      }

      testOutput.textContent = log.join('\n');
      return log.every(l => l.startsWith('‚úÖ'));
    }

    testBtn.addEventListener('click', runTests);
  </script>
</body>
</html> 
